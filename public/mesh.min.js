var MESH=function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t),n.d(t,"Model",(function(){return M})),n.d(t,"Hex",(function(){return C})),n.d(t,"Player",(function(){return S})),n.d(t,"World",(function(){return D})),n.d(t,"initScene",(function(){return u})),n.d(t,"Input",(function(){return z}));var i=window.BABYLON;const o={LEFT:!1,RIGHT:!1,UP:!1,DOWN:!1,SPACE:!1};function a(){return o}let r,s,l,f=null;function h(){return f}function c(){return l}let d=!0;function u(){console.log("INIT SCENE"),document.addEventListener("keydown",e=>{"KeyW"==e.code&&(o.UP=!0),"KeyA"==e.code&&(o.LEFT=!0),"KeyS"==e.code&&(o.DOWN=!0),"KeyD"==e.code&&(o.RIGHT=!0),"Space"==e.code&&(o.SPACE=!0)}),document.addEventListener("keyup",e=>{"KeyW"==e.code&&(o.UP=!1),"KeyA"==e.code&&(o.LEFT=!1),"KeyS"==e.code&&(o.DOWN=!1),"KeyD"==e.code&&(o.RIGHT=!1),"Space"==e.code&&(o.SPACE=!1)});const e=document.getElementById("renderCanvas");if(!e)return;const t=new i.Engine(e,!0,{preserveDrawingBuffer:!0,stencil:!0,premultipliedAlpha:!1});return function(e,t){f=new i.Scene(t),f.ambientColor=new i.Color3(1,1,1),s=new i.TargetCamera("isometricCamera",new i.Vector3(5,5,0),f),s.mode=i.Camera.ORTHOGRAPHIC_CAMERA,s.orthoTop=10,s.orthoBottom=-10,s.orthoLeft=-10,s.orthoRight=10,s.setTarget(new i.Vector3(0,0,0)),s.attachControl(e,!0),f.onBeforeRenderObservable.add(()=>{const e=t.getRenderWidth(),n=t.getRenderHeight();s.orthoLeft=-10*e/n,s.orthoTop=10,s.orthoRight=10*e/n,s.orthoBottom=-10}),r=new i.ArcRotateCamera("arcCamera",0,0,10,new i.Vector3(0,0,-10),f),r.setPosition(new i.Vector3(0,6,-7)),r.setTarget(new i.Vector3(0,0,-.5)),r.attachControl(e,!0),f.activeCamera=d?r:s,d=!d;var n=new i.DirectionalLight("light1",new i.Vector3(.5,-1,0),f);n.diffuse=new i.Color3(.4,.6,.6),n.specular=new i.Color3(.5,.2,.2),n.intensity=4,n.range=10,n.shadowEnabled=!0,l=new i.ShadowGenerator(128,n),l.useBlurExponentialShadowMap=!0,l.useKernelBlur=!0,l.blurKernel=1,f.environmentTexture=new i.CubeTexture("environment.env",f)}(e,t),t.runRenderLoop((function(){f.render()})),window.addEventListener("resize",(function(){t.resize()})),f}function p(e){return e*(Math.PI/180)}class b{constructor(e,t){return this.meshes=[],this.pos=e,this.coords=function(e){return{x:Math.sin(p(e.angle))*e.distance,z:Math.cos(p(e.angle))*e.distance,height:e.height}}(e),this.rotation=t||0,this}setEnabled(e){this.enabled=e,this.meshes.length>0&&this.meshes.forEach(t=>{t.setEnabled(e)})}toggleEnabled(){this.enabled=!this.enabled,this.meshes.length>0&&this.meshes.forEach(e=>{e.setEnabled(this.enabled)})}}function g(){const e={};return Object.entries(w).map(([t,n])=>{const o=(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null;var a;e[t]=new i.Color4(o.r/255,o.g/255,o.b/255,1)}),(t=e).tilegreen=new i.Color4(.2,.4,.2,1),t.tileblue=new i.Color4(.2,.2,.4,1),t.bluegrey=new i.Color4(.8,.8,.9,1),t;var t}function m(){const e={};return Object.entries(g()).forEach(([t,n])=>{e[t]=[n,n,n]}),e}const w={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},v="/models/import/",y={fullHex:{path:"/models/tiles/",file:"fullHex.glb",scale:.2,rotate:Math.PI/6},sandtile:{path:"/models/tiles/",file:"sandtile.glb",scale:.2,rotate:Math.PI/6},sonoran:{path:"/models/tiles/",file:"sonoran.glb",scale:.2,rotate:Math.PI/6},grassrock:{path:"/models/tiles/",file:"grassrock.glb",scale:.2,rotate:Math.PI/6},snowrock:{path:"/models/tiles/",file:"snowrock.glb",scale:.2,rotate:Math.PI/6},nopal:{path:v+"nopal/",file:"Nopal_Big.gltf",scale:.45},pod:{path:"/models/",file:"pod1.gltf",scale:.23,rotate:1.25*Math.PI,shadow:!0},tree01:{path:v+"town_trees/",file:"tree.glb",scale:.75},tree_round:{path:v,file:"nature.glb",scale:.25,child:28,offset:[-4.2,-4.6]},tree_cone:{path:v,file:"nature.glb",scale:.25,child:29,offset:[-4.2,-4]},tree_pine1:{path:v,file:"nature.glb",scale:.25,child:30,offset:[-4.2,-3.125]},tree_pine2:{path:v,file:"nature.glb",scale:.26,child:31,offset:[-4.2,-2.25]},tree_pine3:{path:v,file:"nature.glb",scale:.26,child:32,offset:[-4.2,-1.5]},tree_pine4:{path:v,file:"nature.glb",scale:.26,child:33,offset:[-4.2,-.5]},lgrock1:{path:v,file:"nature.glb",scale:.26,child:12,offset:[-6,3.7]},lgrock2:{path:v,file:"nature.glb",scale:.26,child:14,offset:[-6,5.4]},lgrock3:{path:v,file:"nature.glb",scale:.26,child:15,offset:[-6,6.3]},bush01:{path:v+"nature/",file:"bush01.gltf",scale:.46},bush02:{path:v+"nature/",file:"bush02.gltf",scale:.46},bush03:{path:v+"nature/",file:"bush03.gltf",scale:.46},bush04:{path:v+"nature/",file:"bush04.gltf",scale:.46},stone01:{path:v+"nature/",file:"stone01.gltf",scale:.5},stone02:{path:v+"nature/",file:"stone02.gltf",scale:.5},stone03:{path:v+"nature/",file:"stone03.gltf",scale:.5},stone04:{path:v+"nature/",file:"stone04.gltf",scale:.5},weed01:{path:v+"nature/",file:"weed01.gltf",scale:.5},weed02:{path:v+"nature/",file:"weed02.gltf",scale:.5},weed03:{path:v+"nature/",file:"weed03.gltf",scale:.5},weedplant01:{path:v+"nature/",file:"weedplant01.gltf",scale:.5},weedplant02:{path:v+"nature/",file:"weedplant02.gltf",scale:.5},weedplant03:{path:v+"nature/",file:"weedplant03.gltf",scale:.5},weedplant04:{path:v+"nature/",file:"weedplant04.gltf",scale:.5},weedplant05:{path:v+"nature/",file:"weedplant05.gltf",scale:.5},douglasFir01:{path:v+"biome-conForest/",file:"douglasFir01.glb",scale:.2,shadow:!0},douglasFir02:{path:v+"biome-conForest/",file:"douglasFir02.glb",scale:.2,shadow:!0},fern01:{path:v+"biome-conForest/",file:"conForest-fern.glb",scale:.04,shadow:!0}};var _=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};function P(e,t,n){const o=y[e];return new Promise((e,a)=>{i.SceneLoader.ImportMesh("",o.path,o.file,h(),(function(a){let r=a[0];if("number"==typeof o.child){r.getChildren().forEach((e,t)=>{t!==o.child&&e.dispose()})}const s=function(e,t,n,o){return t.map(t=>{t.position.y=0;const{x:a,z:r}=n;t.position.x=e.offset?a+e.offset[0]:a,t.position.z=e.offset?r+e.offset[1]:r;const s=o||e.rotate;return s&&t.addRotation(0,s,0),t.scaling=new i.Vector3(e.scale,e.scale,e.scale),e.shadow&&(c().addShadowCaster(t),c().useBlurExponentialShadowMap=!0,c().getShadowMap().renderList.push(t),t.receiveShadows=!0),t})}(o,[r],t,n);e(s)}))})}class M extends b{constructor(e,t,n){return super({angle:e,distance:t},n),this.kind="pod",this}init(e){return _(this,void 0,void 0,(function*(){this.kind=e;const t=yield P(e,this.coords,this.rotation);return this.meshes=t,this}))}}var k=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};const x={forest:[m().brown,m().tilegreen],tundra:[m().bluegrey,m.white]};function O(e,t){const{x:n,z:o}=t,a=i.MeshBuilder.CreateCylinder("hexTop",{height:.15,diameter:6,tessellation:6,faceColors:x[e][1]});a.position.y=-.05,a.position.x=n,a.position.z=o,a.receiveShadows=!0;const r=i.MeshBuilder.CreateCylinder("hexBottom",{height:.4,diameter:6,tessellation:6,faceColors:x[e][0]});return r.position.y=-.32,r.position.x=n,r.position.z=o,[a,r]}class C extends b{constructor(e,t){return super({angle:e,distance:t}),this.biome="forest",this}init(e){return k(this,void 0,void 0,(function*(){this.biome=e;const t=yield O(e,this.coords);return this.meshes=t,this}))}setBiome(e){return k(this,void 0,void 0,(function*(){if(this.biome===e)return;this.biome=e,this.meshes.forEach(e=>{e.dispose()});const t=yield O(e,this.coords);this.meshes=t}))}}var E=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class S extends b{constructor(e,t){return super({distance:e,angle:t},0),this}beforeRenderUpdate(){this.meshes.length<1||this._updateFromControls()}_updateFromControls(){if(0===this.meshes.length)return;this._h=this._input.horizontal,this._v=this._input.vertical;let e=this.meshes[0],t=i.Vector3.Zero();e.rotationQuaternion&&(t=e.rotationQuaternion.toEulerAngles());this._v>0?(this.anims.JOG.start(),e.moveWithCollisions(new i.Vector3(parseFloat(Math.sin(t.y))/20,0,parseFloat(Math.cos(t.y))/20))):this._v<0&&(this.anims.JOG.stop(),e.moveWithCollisions(new i.Vector3(parseFloat(Math.sin(t.y))/-20/3,0,parseFloat(Math.cos(t.y))/-20/3))),this._h>0?e.rotate(i.Axis.Y,.075,i.Space.WORLD):this._h<0&&e.rotate(i.Axis.Y,-.075,i.Space.WORLD)}init(e,t){return E(this,void 0,void 0,(function*(){if(t&&(this._input=t),"podling"===e){const{mesh:e,anims:t}=yield new Promise((e,t)=>{i.SceneLoader.ImportMesh("","/models/","podling.glb",h(),(function(t,n,o,a){const r=t[0];r.addRotation(0,0,0),r.position.y=0,r.position.x=0,r.position.z=5,r.scaling=new i.Vector3(.2,.2,.2);const s={JOG:a[0],JUMP_FORWARD:a[1],JUMP_UP:a[2],STAND:a[3]};s.JOG.stop(),s.STAND.start(),e({mesh:r,anims:s})}))});return this.meshes=[e],this.anims=t,this}}))}loop(){this.meshes.length>0&&function(e,t){if(a().UP||a().DOWN){var n=.1*Math.sin(e.rotation.y),o=.1*Math.cos(e.rotation.y);if(a().UP){var r=new i.Vector3(n,0,o);e.moveWithCollisions(r),t.JOG.start()}else t.JOG.stop();if(a().DOWN){var s=new i.Vector3(-n,0,-o);e.moveWithCollisions(s)}}a().LEFT&&e.rotate(i.Vector3.Up(),-.05);a().RIGHT&&e.rotate(i.Vector3.Up(),.05);a().SPACE&&(t.JUMP_FORWARD.start(),setTimeout(()=>{t.JUMP_FORWARD.stop()},1e3))}(this.meshes[0],this.anims)}}var A=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((i=i.apply(e,t||[])).next())}))};class D{constructor(){return this.tileSize=1,this.hexes=[],this}init(e,t){return A(this,void 0,void 0,(function*(){this.tileSize=t,this.hexes.push(new M(0,0));for(let t=0;t<e.length;t++){let n=e[t];const i=R(n.length);for(let e=0;e<i.length;e++){let o=n[e],a=new M(i[e],this.tileSize*t);this.hexes.push(a),yield a.init(o)}}return this}))}}function R(e){return Array.from({length:e},(t,n)=>360*n/e)}const{ActionManager:B,ExecuteCodeAction:T,Scalar:U}=i;class z{constructor(e,t){this.horizontal=0,this.vertical=0,this.horizontalAxis=0,this.verticalAxis=0,this.jumpKeyDown=!1,this.dashing=!1,this._scene=e,this._ui=t,this._scene.actionManager=new B(this._scene),this.inputMap={},this._scene.actionManager.registerAction(new T(B.OnKeyDownTrigger,e=>{this.inputMap[e.sourceEvent.key]="keydown"==e.sourceEvent.type})),this._scene.actionManager.registerAction(new T(B.OnKeyUpTrigger,e=>{this.inputMap[e.sourceEvent.key]="keydown"==e.sourceEvent.type})),e.onBeforeRenderObservable.add(()=>{this._updateFromKeyboard()}),this._ui.isMobile&&this._setUpMobile()}_updateFromKeyboard(){!this.inputMap.w&&!this.mobileUp||this._ui.gamePaused?!this.inputMap.s&&!this.mobileDown||this._ui.gamePaused?(this.vertical=0,this.verticalAxis=0):(this.vertical=U.Lerp(this.vertical,-1,.2),this.verticalAxis=-1):(this.verticalAxis=1,this.vertical=U.Lerp(this.vertical,1,.2)),!this.inputMap.a&&!this.mobileLeft||this._ui.gamePaused?!this.inputMap.d&&!this.mobileRight||this._ui.gamePaused?(this.horizontal=0,this.horizontalAxis=0):(this.horizontal=U.Lerp(this.horizontal,1,.2),this.horizontalAxis=1):(this.horizontal=U.Lerp(this.horizontal,-1,.2),this.horizontalAxis=-1),!this.inputMap.Shift&&!this._mobileDash||this._ui.gamePaused?this.dashing=!1:this.dashing=!0,!this.inputMap[" "]&&!this._mobileJump||this._ui.gamePaused?this.jumpKeyDown=!1:this.jumpKeyDown=!0}_setUpMobile(){this._ui.jumpBtn.onPointerDownObservable.add(()=>{this._mobileJump=!0}),this._ui.jumpBtn.onPointerUpObservable.add(()=>{this._mobileJump=!1}),this._ui.dashBtn.onPointerDownObservable.add(()=>{this._mobileDash=!0}),this._ui.dashBtn.onPointerUpObservable.add(()=>{this._mobileDash=!1}),this._ui.leftBtn.onPointerDownObservable.add(()=>{this.mobileLeft=!0}),this._ui.leftBtn.onPointerUpObservable.add(()=>{this.mobileLeft=!1}),this._ui.rightBtn.onPointerDownObservable.add(()=>{this.mobileRight=!0}),this._ui.rightBtn.onPointerUpObservable.add(()=>{this.mobileRight=!1}),this._ui.upBtn.onPointerDownObservable.add(()=>{this.mobileUp=!0}),this._ui.upBtn.onPointerUpObservable.add(()=>{this.mobileUp=!1}),this._ui.downBtn.onPointerDownObservable.add(()=>{this.mobileDown=!0}),this._ui.downBtn.onPointerUpObservable.add(()=>{this.mobileDown=!1})}}}]);